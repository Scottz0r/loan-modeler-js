<html>

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <script src="loan_engine.js"></script>
</head>
<body>

  <div id="app" class="container">
    <div class="row">
      <h1>Loan Modeler</h1>
      <p>This page allows you to model loans and the impact of extra payments. Extra payments can be extra paid each month, or one-time additional payments.</p>
    </div>
    <div class="row justify-content-lg-center">
      <div class="card col-lg-4">
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">Principle</label>
            <input class="form-control" type="number" v-model.number="input.principle">
          </div>
          <div class="mb-3">
            <label class="form-label">Rate (%)</label>
            <input class="form-control" type="number" v-model.number="input.rate">
          </div>
          <div class="mb-3">
            <label class="form-label">Compound per Year</label>
            <input class="form-control" type="number" v-model.number="input.compoundPerYear">
          </div>
          <div class="mb-3">
            <label class="form-label">Payment per Year</label>
            <input class="form-control" type="number" v-model.number="input.paymentPerYear">
          </div>
          <div class="mb-3">
            <label class="form-label">Total Payments</label>
            <input class="form-control" type="number" v-model.number="input.totalPayments">
          </div>
          <div class="mb-3">
            <label class="form-label">Extra Monthly Payment</label>
            <input class="form-control" type="number" v-model.number="input.extraMonthlyPayment">
          </div>
      
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Month</th>
                <th>Amount</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="item in input.extraPayments" v-bind:key="item.month">
                <td><input class="form-control-sm" type="number" v-model.number="item.month"></td>
                <td><input class="form-control-sm" type="number" v-model.number="item.amount"></td>
                <td><button class="btn btn-close" v-on:click="removeExtraPayment(item.month)"></button></td>
              </tr>
            </tbody>
          </table>
          <div class="d-grid justify-content-center">
            <button class="btn btn-outline-primary btn-sm" v-on:click="addExtraPayment">Add</button>
          </div>
      
          <button class="btn btn-primary" v-on:click="calculate">Calculate</button>
        </div>
      </div>
    </div>
      
    <table class="table table-striped" v-if="results.length > 0">
      <thead>
        <tr>
          <th>Period</th>
          <th>Payment</th>
          <th>Interest Payment</th>
          <th>Principle Payment</th>
          <th>Principle</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="item in results" v-bind:key="item.period">
          <td>{{ item.period.toFixed(0) }}</td>
          <td>{{ item.payment.toFixed(2) }}</td>
          <td>{{ item.interestPayment.toFixed(2) }}</td>
          <td>{{ item.principlePayment.toFixed(2) }}</td>
          <td>{{ item.principle.toFixed(2) }}</td>
        </tr>
      </tbody>
    </table>

  </div>
  <script>
    var vm = new Vue({
      el: "#app",
      data: {
        input: {
          principle: 200000,
          rate: 3.00,
          compoundPerYear: 12,
          paymentPerYear: 12,
          totalPayments: 240,
          extraMonthlyPayment: 0.00,
          extraPayments: [
            {
              month: 12,
              amount: 10000
            }
          ]
        },
        results: []
      },
      methods: {
        calculate: function() {
          // Copy object so the rate can be converted into a deciaml without impacting the UI. This also
          // converts observer objects into plain ole JavaScript types.
          let c = {
            principle: this.input.principle,
            rate: this.input.rate / 100,
            compoundPerYear: this.input.compoundPerYear,
            paymentPerYear: this.input.paymentPerYear,
            totalPayments: this.input.totalPayments,
            extraMonthlyPayment: this.input.extraMonthlyPayment,
            extraPayments: JSON.parse(JSON.stringify(this.input.extraPayments))
          }
          this.results = amortizationSchedule(c)
        },
        removeExtraPayment: function(month) {
          const i = this.input.extraPayments.findIndex(x => x.month === month)
          if (i > -1) {
            this.input.extraPayments.splice(i, 1)
          }
        },
        addExtraPayment: function() {
          let m = -1
          let amt = 1000
          
          // If any item exists, set the month to one past and use the same amount as the existing one.
          const arr = this.input.extraPayments
          for (let i = 0; i < arr.length; i++) {
            if (arr[i].month > m) {
              m = arr[i].month + 1
              amt = arr[i].amount
            }
          }

          if(m <= 0) {
            m = 1
          }

          this.input.extraPayments.push({month: m, amount: amt})
        }
      }
    });
  </script>
</body>

</html>
